<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>.:: NodeMCU e MQTT - IoT ::.</title>
<link rel="stylesheet" type="text/css" href="style.css"/>
<script type='text/javascript' src='mosquitto.js'></script>
<script type='text/javascript' src='http://code.jquery.com/jquery-1.7.2.min.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript">
<script type="text/javascript">
</script>
</head>
<body>
	
    <center>
    <table border ="0" width="100%">
            <td bgcolor = "#3D3D3F" width="70%">
                <center><font color =white><h1>NodeMCU e MQTT - IoT</h1><br></font>
                </center>
            </td>
        </tr>        
    </table>

<div id="publish">
    <br>
    <font color="#3D3D3F"><b>1º passo:</b></font> definir os tópicos MQTT de subscribe e publish:
    <p>Tópico de envio de informações: <input class="txt" id="pub-topic-text" type="text" value="pbl3/teste"></p>
    <p>Tópico de recepcao de informações: <input class="txt" id="pub-subscribe-text" type="text" value="pbl3/envia"></p>
    <br>
    
    <!--<input class="but" id="liga-output" type="button"    value="  Ligar "><br><br>
    <input class="but" id="desliga-output" type="button" value="Desligar"><br><br>-->
    
</div>     
    
<div id="broker">
    <font color="#3D3D3F"><b>2º Passo:</b></font> conectar-se ao servidor / broker:<br><br>
    <input class="but" id="connect-button" type="button" value="Conectar">
    <input class="but" id="disconnect-button" type="button" value="Desconectar">
</div>
<br><br>
<font color="#3D3D3F"><b>3º passo:</b></font> escolha a ação desejada:<br><br>
<input class="but" id="liga-output" type="button"    value="  Ligar ">
<input class="but" id="desliga-output" type="button" value="Desligar"><br><br>

<p><font color="#3D3D3F"><b>Status do output (vindos do NodeMCU via MQTT):</b></font></p>
<div id="status_io"></div>

<p><b>Debug / respostas do servidor:</b></p>
<div id="debug"></div>
    
    <!-- <script src="script.js" type="text/javascript"></script> -->
    <script type="text/javascript" language="javascript">
    	var mqtt;
	var reconnectTimeout = 2000;
	var host="10.0.0.101"; //change this
	var port=9001;
		
 	function onConnect() {
	  	// Once a connection has been made, make a subscription and send a message.
		console.log("Connected ");
		//mqtt.subscribe("sensor1");
		message = new Paho.MQTT.Message("Hello World");
		message.destinationName = "sensor1";
		mqtt.send(message);
	}
	function MQTTconnect() {
		console.log("connecting to "+ host +" "+ port);
		mqtt = new Paho.MQTT.Client(host,port,"clientjs");
		//document.write("connecting to "+ host);
		var options = {
			//useSSL:true,
			timeout: 3,
			userName: "aluno",
			password: "@luno*123",
			onSuccess: onConnect
		 };
		 
		mqtt.connect(options); //connect
	}
    </script>
    <script>
		MQTTconnect();
	</script>
    </center>
</body>
</html>


